# Linux privilege escalation

## Abusing SUID/GUID files

- SUID: `rws-rwx-rwx`
- GUID: `rwx-rws-rwx`

```bash
find "$DIRECTORY" -perm /4000     # SUID
find "$DIRECTORY" -perm /u=s      # SUID
find "$DIRECTORY" -perm /2000     # SGID
find "$DIRECTORY" -perm /g=s      # SGID
find "$DIRECTORY" -perm /6000     # SGID + SUID
find "$DIRECTORY" -perm /u=s,g=s  # SGID + SUID
```

## Exploiting a writeable /etc/passwd

- Line format `username:password:uid:gid:info:home:shell
- Example line `admin:x:0:0:root:/root:/bin/bash`
- Geberate password hash ``openssl passwd -1 -salt [salt] [password]

## Escaping Vi editor

```bash
sudo -l
sudo -i
```

[https://gtfobins.github.io/](https://gtfobins.github.io/)

## Exploiting Crontab

**What is Cron?**

The Cron daemon is a long-running process that executes commands at specific dates and times. You can use this to schedule activities, either as one-time events or as recurring tasks. You can create a crontab file containing commands and instructions for the Cron daemon to execute.

**How to view what Cronjobs are active.**

We can use the command **"cat /etc/crontab"** to view what cron jobs are scheduled. This is something you should always check manually whenever you get a chance, especially if LinEnum, or a similar script, doesn't find anything.

**Format of a Cronjob**

Cronjobs exist in a certain format, being able to read that format is important if you want to exploit a cron job.

| keyword | meaning |
| :--- | :--- |
| \# | ID |
| m | Minute |
| h | Hour |
| dom | Day of the month |
| mon | Month |
| dow | Day of the week |
| user | What user the command will run as |
| command | What command should be run |

For Example,

**\# m h dom mon dow user command**

```text
17 * 1 * * * root cd / && run-parts --report /etc/cron.hourly
```

**How can we exploit this?**

We know from our LinEnum scan, that the file autoscript.sh, on user4's Desktop is scheduled to run every five minutes. It is owned by root, meaning that it will run with root privileges, despite the fact that we can write to this file. The task then is to create a command that will return a shell and paste it in this file. When the file runs again in five minutes the shell will be running as root.

**Let's do it!**

## Exploiting the PATH variable

**What is PATH?**

PATH is an environmental variable in Linux and Unix-like operating systems which specifies directories that hold executable programs. When the user run any command in the terminal, it searches for executable files with the help of the PATH Variable in response to commands executed by a user.

It is very simple to view the Path of the relevant user with help of the command **"echo $PATH"**.

**How does this let us escalate privileges?**

Let's say we have an SUID binary. Running it, we can see that itâ€™s calling the system shell to do a basic process like list processes with "ps". Unlike in our previous SUID example, in this situation we can't exploit it by supplying an argument for command injection, so what can we do to try and exploit this?

We can re-write the PATH variable to a location of our choosing! So when the SUID binary calls the system shell to run an executable, it runs one that we've written instead!

As with any SUID file, it will run this command with the same privileges as the owner of the SUID file! If this is root, using this method we can run whatever commands we like as root!

**Let's do it!**

Let's go to user5's home directory, and run the file "script". What command do we think that it's executing?

Now we know what command to imitate, let's change directory to "tmp".

**Now we're inside tmp, let's create an imitation executable.**

```bash
echo "/bin/bash/" > ls
chmod +x ls
```

**Now, we need to change the PATH variable, so that it points to the directory where we have our imitation "ls" stored! We do this using the command "export PATH=/tmp:$PATH"**

**Note, this will cause you to open a bash prompt every time you use "ls". If you need to use "ls" before you finish the exploit, use "/bin/ls" where the real "ls" executable is.**

**Once you've finished the exploit, you can exit out of root and use "export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:$PATH" to reset the PATH variable back to default, letting you use "ls" again!**

Now, run the "script" file again, you should be sent into a root bash prompt! Congratulations!

## Further learing

* [https://github.com/netbiosX/Checklists/blob/master/Linux-Privilege-Escalation.md](https://github.com/netbiosX/Checklists/blob/master/Linux-Privilege-Escalation.md)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md)
* [https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_-\_linux.html](https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_-_linux.html)
* [https://payatu.com/guide-linux-privilege-escalation](https://payatu.com/guide-linux-privilege-escalation)


